<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bat-Sinal com Relâmpagos</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
    #startMsg {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-family: sans-serif;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<div id="startMsg">Clique para iniciar o som!</div>
<canvas id="batCanvas"></canvas>
<audio id="batSound" src="https://cdn.pixabay.com/download/audio/2022/02/14/audio_4da8681768.mp3?filename=strong-wind-blowing-ambient-120911.mp3" loop></audio>
<audio id="thunderSound" src="https://cdn.pixabay.com/download/audio/2022/03/28/audio_2d82e77f82.mp3?filename=thunder-and-rain-109197.mp3"></audio>

<script>
  const canvas = document.getElementById('batCanvas');
  const ctx = canvas.getContext('2d');
  const startMsg = document.getElementById('startMsg');

  let width = window.innerWidth;
  let height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;

  window.addEventListener('resize', () => {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  });

  const bgImage = new Image();
  bgImage.src = 'https://images.unsplash.com/photo-1534447677768-be436bb09401?auto=format&fit=crop&w=1500&q=80';

  const clouds = Array.from({ length: 5 }).map(() => ({
    x: Math.random() * width,
    y: Math.random() * height * 0.7,
    speed: 0.2 + Math.random() * 0.5,
    opacity: 0.1 + Math.random() * 0.2,
    size: 200 + Math.random() * 200
  }));

  let mouseX = width / 2;
  let mouseY = height / 2;

  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  const baseX = width * 0.2;
  const baseY = height * 0.8;

  let lightning = false;
  let lightningTimer = 0;

  function triggerLightning() {
    lightning = true;
    setTimeout(() => {
      lightning = false;
    }, 100 + Math.random() * 200);

    // Play som de trovão
    const thunder = document.getElementById('thunderSound');
    thunder.currentTime = 0;
    thunder.play();

    // Próximo relâmpago
    lightningTimer = Date.now() + 3000 + Math.random() * 5000;
  }

  function drawBackground() {
    const parallaxFactor = 0.02;
    const offsetX = (mouseX - width / 2) * parallaxFactor;
    const offsetY = (mouseY - height / 2) * parallaxFactor;

    ctx.drawImage(bgImage, offsetX, offsetY, width, height);
  }

  function drawLightCone(x, y, angle, spread, length) {
    const gradient = ctx.createRadialGradient(x, y, 0, x, y, length);
    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.6)');
    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');

    ctx.fillStyle = gradient;

    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + length * Math.cos(angle - spread / 2), y + length * Math.sin(angle - spread / 2));
    ctx.lineTo(x + length * Math.cos(angle + spread / 2), y + length * Math.sin(angle + spread / 2));
    ctx.closePath();
    ctx.fill();
  }

  function drawBatSymbol(x, y, size, angle) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle + Math.PI / 2);
    ctx.fillStyle = 'white';

    ctx.beginPath();
    ctx.moveTo(-size/2, 0);
    ctx.quadraticCurveTo(-size/4, -size/4, 0, -size/2);
    ctx.quadraticCurveTo(size/4, -size/4, size/2, 0);
    ctx.quadraticCurveTo(size/4, size/4, 0, size/2);
    ctx.quadraticCurveTo(-size/4, size/4, -size/2, 0);
    ctx.fill();

    ctx.restore();
  }

  function drawCloud(cloud) {
    ctx.save();
    ctx.globalAlpha = cloud.opacity;
    ctx.fillStyle = '#fff';

    ctx.beginPath();
    ctx.ellipse(cloud.x, cloud.y, cloud.size, cloud.size * 0.4, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
  }

  function animate() {
    ctx.clearRect(0, 0, width, height);

    if (bgImage.complete) {
      drawBackground();
    }

    const dx = mouseX - baseX;
    const dy = mouseY - baseY;
    const angle = Math.atan2(dy, dx);

    const spread = Math.PI / 8;
    const length = Math.min(width, height) * 1.2;

    drawLightCone(baseX, baseY, angle, spread, length);

    const batX = baseX + length * 0.7 * Math.cos(angle);
    const batY = baseY + length * 0.7 * Math.sin(angle);

    drawBatSymbol(batX, batY, 100, angle);

    clouds.forEach(cloud => {
      drawCloud(cloud);
      cloud.x += cloud.speed;
      if (cloud.x - cloud.size > width) {
        cloud.x = -cloud.size;
        cloud.y = Math.random() * height * 0.7;
      }
    });

    // Relâmpago
    if (lightning) {
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.fillRect(0, 0, width, height);
    }

    // Checar se é hora de novo relâmpago
    if (Date.now() > lightningTimer) {
      triggerLightning();
    }

    requestAnimationFrame(animate);
  }

  bgImage.onload = animate;

  const batSound = document.getElementById('batSound');
  document.body.addEventListener('click', () => {
    batSound.play();
    startMsg.style.display = 'none';
  }, { once: true });

</script>

</body>
</html>
